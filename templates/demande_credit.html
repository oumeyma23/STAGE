<!DOCTYPE html>
<html lang="{% if current_language == 'ar' %}ar{% else %}fr{% endif %}" {% if current_language == 'ar' %}dir="rtl"{% endif %}>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if current_language == 'ar' %}Ø·Ù„Ø¨ Ø§Ø¦ØªÙ…Ø§Ù†{% elif current_language == 'en' %}Credit Application{% else %}Demande de CrÃ©dit{% endif %} - SecuriBank</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/overrides.css') }}">
</head>
<body>
  {% include 'navbar.html' %}

  <header class="masthead">
{{ ... }}
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="text-center mb-4">
            <h2 class="text-white mb-3">
              <i class="bi-credit-card-2-front"></i>
              {% if current_language == 'ar' %}
                Ø·Ù„Ø¨ Ø§Ø¦ØªÙ…Ø§Ù†
              {% elif current_language == 'en' %}
                Credit Application
              {% else %}
                Demande de CrÃ©dit
              {% endif %}
            </h2>
            <p class="text-white-75">
              {% if current_language == 'ar' %}
                Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ³ÙŠÙ‚ÙˆÙ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨ØªØ­Ù„ÙŠÙ„ Ø·Ù„Ø¨Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
              {% elif current_language == 'en' %}
                Fill out the form below and our AI system will automatically analyze your application
              {% else %}
                Remplissez le formulaire ci-dessous et notre IA analysera automatiquement votre demande
              {% endif %}
            </p>
          </div>

          <!-- Progress Steps -->
          <div class="progress-steps mb-4">
            <div class="step active" id="nav-step-1">
              <span class="step-number">1</span>
              <span class="step-title">
                {% if current_language == 'ar' %}Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©{% elif current_language == 'en' %}Personal Info{% else %}Infos Personnelles{% endif %}
              </span>
            </div>
            <div class="step" id="nav-step-2">
              <span class="step-number">2</span>
              <span class="step-title">
                {% if current_language == 'ar' %}Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø§Ù„ÙŠØ©{% elif current_language == 'en' %}Financial Info{% else %}Infos FinanciÃ¨res{% endif %}
              </span>
            </div>
            <div class="step" id="nav-step-3">
              <span class="step-number">3</span>
              <span class="step-title">
                {% if current_language == 'ar' %}Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¥Ø±Ø³Ø§Ù„{% elif current_language == 'en' %}Review & Submit{% else %}RÃ©vision & Envoi{% endif %}
              </span>
            </div>
          </div>

          <!-- Success/Error Messages -->
          {% if success %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
              <i class="bi-check-circle-fill"></i>
              {{ success }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endif %}

          {% if error %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <i class="bi-exclamation-triangle-fill"></i>
              {{ error }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endif %}

          <!-- Form -->
          <form id="creditForm" method="POST" action="/demande_credit" novalidate>
            
            <!-- Step 1: Personal Information -->
            <div class="step-card" id="step1">
              <div class="step-header">
                <h4><i class="bi-person-circle"></i> 
                  {% if current_language == 'ar' %}
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                  {% elif current_language == 'en' %}
                    Personal Information
                  {% else %}
                    Informations Personnelles
                  {% endif %}
                </h4>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-person"></i>
                    {% if current_language == 'ar' %}
                      Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="required">*</span>
                    {% elif current_language == 'en' %}
                      Full Name <span class="required">*</span>
                    {% else %}
                      Nom complet <span class="required">*</span>
                    {% endif %}
                  </label>
                  <input type="text" class="form-control" name="Name" required placeholder="PrÃ©nom Nom">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-calendar-date"></i>
                    {% if current_language == 'ar' %}
                      Ø§Ù„Ø¹Ù…Ø± <span class="required">*</span>
                    {% elif current_language == 'en' %}
                      Age <span class="required">*</span>
                    {% else %}
                      Ã‚ge <span class="required">*</span>
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Age" min="18" max="80" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-card-text"></i>
                    {% if current_language == 'ar' %}
                      Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ© <span class="required">*</span>
                    {% elif current_language == 'en' %}
                      Social Security Number <span class="required">*</span>
                    {% else %}
                      NumÃ©ro de SÃ©curitÃ© Sociale <span class="required">*</span>
                    {% endif %}
                  </label>
                  <input type="text" class="form-control" name="SSN" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-briefcase"></i>
                    {% if current_language == 'ar' %}
                      Ø§Ù„Ù…Ù‡Ù†Ø© <span class="required">*</span>
                    {% elif current_language == 'en' %}
                      Occupation <span class="required">*</span>
                    {% else %}
                      Profession <span class="required">*</span>
                    {% endif %}
                  </label>
                  <select class="form-control" name="Occupation" required>
                    <option value="">{% if current_language == 'ar' %}Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‡Ù†Ø©...{% elif current_language == 'en' %}Choose occupation...{% else %}Choisir la profession...{% endif %}</option>
                    <option value="Engineer">{% if current_language == 'ar' %}Ù…Ù‡Ù†Ø¯Ø³{% elif current_language == 'en' %}Engineer{% else %}IngÃ©nieur{% endif %}</option>
                    <option value="Teacher">{% if current_language == 'ar' %}Ù…Ø¹Ù„Ù…{% elif current_language == 'en' %}Teacher{% else %}Enseignant{% endif %}</option>
                    <option value="Doctor">{% if current_language == 'ar' %}Ø·Ø¨ÙŠØ¨{% elif current_language == 'en' %}Doctor{% else %}MÃ©decin{% endif %}</option>
                    <option value="Lawyer">{% if current_language == 'ar' %}Ù…Ø­Ø§Ù…ÙŠ{% elif current_language == 'en' %}Lawyer{% else %}Avocat{% endif %}</option>
                    <option value="Manager">{% if current_language == 'ar' %}Ù…Ø¯ÙŠØ±{% elif current_language == 'en' %}Manager{% else %}Directeur{% endif %}</option>
                    <option value="Accountant">{% if current_language == 'ar' %}Ù…Ø­Ø§Ø³Ø¨{% elif current_language == 'en' %}Accountant{% else %}Comptable{% endif %}</option>
                    <option value="Developer">{% if current_language == 'ar' %}Ù…Ø·ÙˆØ±{% elif current_language == 'en' %}Developer{% else %}DÃ©veloppeur{% endif %}</option>
                    <option value="Other">{% if current_language == 'ar' %}Ø£Ø®Ø±Ù‰{% elif current_language == 'en' %}Other{% else %}Autre{% endif %}</option>
                  </select>
                </div>
              </div>

              <div class="step-navigation">
                <button type="button" class="btn btn-primary" onclick="nextStep(1)">
                  {% if current_language == 'ar' %}Ø§Ù„ØªØ§Ù„ÙŠ{% elif current_language == 'en' %}Next{% else %}Continuer{% endif %} 
                  <i class="bi-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 2: Financial Information -->
            <div class="step-card hidden" id="step2">
              <div class="step-header">
                <h4><i class="bi-cash-stack"></i> 
                  {% if current_language == 'ar' %}
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                  {% elif current_language == 'en' %}
                    Financial Information
                  {% else %}
                    Informations FinanciÃ¨res
                  {% endif %}
                </h4>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-currency-dollar"></i>
                    {% if current_language == 'ar' %}
                      Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ <span class="required">*</span>
                    {% elif current_language == 'en' %}
                      Annual Income <span class="required">*</span>
                    {% else %}
                      Revenu annuel <span class="required">*</span>
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Annual_Income" min="0" step="1000" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-wallet2"></i>
                    {% if current_language == 'ar' %}
                      Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠ <span class="required">*</span>
                    {% elif current_language == 'en' %}
                      Monthly Net Salary <span class="required">*</span>
                    {% else %}
                      Salaire mensuel net <span class="required">*</span>
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Monthly_Inhand_Salary" min="0" step="100" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-bank"></i>
                    {% if current_language == 'ar' %}
                      Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØµØ±ÙÙŠØ©
                    {% elif current_language == 'en' %}
                      Number of Bank Accounts
                    {% else %}
                      Nombre de comptes bancaires
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Num_Bank_Accounts" min="0" max="10" value="1">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-credit-card"></i>
                    {% if current_language == 'ar' %}
                      Ø¹Ø¯Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†
                    {% elif current_language == 'en' %}
                      Number of Credit Cards
                    {% else %}
                      Nombre de cartes de crÃ©dit
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Num_Credit_Card" min="0" max="10" value="0">
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-list-ol"></i>
                    {% if current_language == 'ar' %}
                      Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±ÙˆØ¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    {% elif current_language == 'en' %}
                      Number of Current Loans
                    {% else %}
                      Nombre de prÃªts en cours
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Num_of_Loan" min="0" max="10" value="0">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">
                    <i class="bi-house-door"></i>
                    {% if current_language == 'ar' %}
                      Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø±Ø¶
                    {% elif current_language == 'en' %}
                      Type of Loan
                    {% else %}
                      Type de prÃªt
                    {% endif %}
                  </label>
                  <select class="form-control" name="Type_of_Loan">
                    <option value="Not Specified">{% if current_language == 'ar' %}ØºÙŠØ± Ù…Ø­Ø¯Ø¯{% elif current_language == 'en' %}Not Specified{% else %}Non spÃ©cifiÃ©{% endif %}</option>
                    <option value="Auto Loan">{% if current_language == 'ar' %}Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©{% elif current_language == 'en' %}Auto Loan{% else %}PrÃªt automobile{% endif %}</option>
                    <option value="Personal Loan">{% if current_language == 'ar' %}Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ{% elif current_language == 'en' %}Personal Loan{% else %}PrÃªt personnel{% endif %}</option>
                    <option value="Mortgage Loan">{% if current_language == 'ar' %}Ù‚Ø±Ø¶ Ø¹Ù‚Ø§Ø±ÙŠ{% elif current_language == 'en' %}Mortgage Loan{% else %}PrÃªt hypothÃ©caire{% endif %}</option>
                    <option value="Student Loan">{% if current_language == 'ar' %}Ù‚Ø±Ø¶ Ø·Ù„Ø§Ø¨ÙŠ{% elif current_language == 'en' %}Student Loan{% else %}PrÃªt Ã©tudiant{% endif %}</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12 mb-3">
                  <label class="form-label">
                    <i class="bi-graph-up"></i>
                    {% if current_language == 'ar' %}
                      Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ«Ù…Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹
                    {% elif current_language == 'en' %}
                      Monthly Investment Amount
                    {% else %}
                      Montant investi mensuellement
                    {% endif %}
                  </label>
                  <input type="number" class="form-control" name="Amount_invested_monthly" min="0" step="50" value="0">
                </div>
              </div>

              <div class="step-navigation">
                <button type="button" class="btn btn-outline-secondary" onclick="prevStep(2)">
                  <i class="bi-arrow-left"></i> 
                  {% if current_language == 'ar' %}Ø§Ù„Ø³Ø§Ø¨Ù‚{% elif current_language == 'en' %}Previous{% else %}PrÃ©cÃ©dent{% endif %}
                </button>
                <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                  {% if current_language == 'ar' %}Ø§Ù„ØªØ§Ù„ÙŠ{% elif current_language == 'en' %}Next{% else %}Continuer{% endif %} 
                  <i class="bi-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 3: Review & Submit -->
            <div class="step-card hidden" id="step3">
              <div class="step-header">
                <h4><i class="bi-check-circle"></i> 
                  {% if current_language == 'ar' %}
                    Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¥Ø±Ø³Ø§Ù„
                  {% elif current_language == 'en' %}
                    Review & Submit
                  {% else %}
                    RÃ©vision et envoi
                  {% endif %}
                </h4>
              </div>
              
              <div class="alert alert-info">
                <i class="bi-robot"></i>
                <strong>
                  {% if current_language == 'ar' %}
                    Ù…Ø¹Ù„ÙˆÙ…Ø©:
                  {% elif current_language == 'en' %}
                    Information:
                  {% else %}
                    Information :
                  {% endif %}
                </strong>
                {% if current_language == 'ar' %}
                  Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø§Ø· Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù† Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©.
                {% elif current_language == 'en' %}
                  Your credit score will be calculated automatically by our AI system based on the information provided.
                {% else %}
                  Votre score de crÃ©dit sera calculÃ© automatiquement par notre systÃ¨me d'IA basÃ© sur les informations fournies.
                {% endif %}
              </div>

              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="consent" required>
                <label class="form-check-label" for="consent">
                  {% if current_language == 'ar' %}
                    Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù‚ÙŠØ§Ù… Ø§Ù„Ø¨Ù†Ùƒ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ¥Ø¬Ø±Ø§Ø¡ ÙØ­ÙˆØµØ§Øª Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©. <span class="required">*</span>
                  {% elif current_language == 'en' %}
                    I authorize the bank to verify the information provided and perform credit checks. <span class="required">*</span>
                  {% else %}
                    J'autorise la banque Ã  vÃ©rifier les informations fournies et Ã  effectuer des vÃ©rifications de crÃ©dit. <span class="required">*</span>
                  {% endif %}
                </label>
              </div>

              <div class="step-navigation">
                <button type="button" class="btn btn-outline-secondary" onclick="prevStep(3)">
                  <i class="bi-arrow-left"></i> 
                  {% if current_language == 'ar' %}Ø§Ù„Ø³Ø§Ø¨Ù‚{% elif current_language == 'en' %}Previous{% else %}PrÃ©cÃ©dent{% endif %}
                </button>
                <button type="submit" class="btn btn-success" id="submitBtn">
                  {% if current_language == 'ar' %}
                    Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
                  {% elif current_language == 'en' %}
                    Submit Application
                  {% else %}
                    Soumettre la demande
                  {% endif %}
                  <i class="bi-check-circle"></i>
                </button>
              </div>
              
              <div class="mt-3 text-center">
                <small class="text-muted">
                  <i class="bi-robot"></i> 
                  {% if current_language == 'ar' %}
                    Ø³ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø·Ù„Ø¨Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                  {% elif current_language == 'en' %}
                    Your application will be analyzed automatically by AI
                  {% else %}
                    Votre demande sera analysÃ©e automatiquement par IA
                  {% endif %}
                </small>
              </div>
            </div>

          </form>

          <div class="mt-3" id="result" style="display:none"></div>

        </div>
      </div>
    </div>
  </header>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentStep = 1;
    const totalSteps = 3;
  
    // Step navigation functions
    function showStep(step) {
      // Hide all steps
      for(let i = 1; i <= totalSteps; i++) {
        const stepElement = document.getElementById('step' + i);
        if (stepElement) {
          stepElement.classList.add('hidden');
        }
        // Update step navigation indicators
        const navStep = document.getElementById('nav-step-' + i);
        if (navStep) {
          navStep.classList.remove('active');
        }
      }
      // Show current step
      const currentStepElement = document.getElementById('step' + step);
      if (currentStepElement) {
        currentStepElement.classList.remove('hidden');
      }
      
      // Update step navigation indicator
      const currentNavStep = document.getElementById('nav-step-' + step);
      if (currentNavStep) {
        currentNavStep.classList.add('active');
      }
      
      // Scroll to top
      window.scrollTo({top: 0, behavior: 'smooth'});
    }
    
    function nextStep(step) {
      if(step < totalSteps) {
        currentStep = step + 1;
        showStep(currentStep);
      }
    }
    
    function prevStep(step) {
      if(step > 1) {
        currentStep = step - 1;
        showStep(currentStep);
      }
    }

    // Form validation on submit
    document.getElementById('creditForm').addEventListener('submit', function(e){
      const form = e.target;
      const submitBtn = document.getElementById('submitBtn');
      
      console.log('ğŸš€ Soumission du formulaire');
      
      // Check consent checkbox
      const consentCheckbox = document.getElementById('consent');
      if(!consentCheckbox.checked) {
        e.preventDefault();
        alert('{% if current_language == "ar" %}ÙŠØ±Ø¬Ù‰ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø´Ø±ÙˆØ· Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ.{% elif current_language == "en" %}Please accept the terms before submitting your application.{% else %}Veuillez accepter les conditions avant de soumettre votre demande.{% endif %}');
        consentCheckbox.focus();
        return;
      }
      
      // Show loading state
      submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> {% if current_language == "ar" %}Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...{% elif current_language == "en" %}Analyzing...{% else %}Analyse en cours...{% endif %}';
      submitBtn.disabled = true;
      
      console.log('âœ… Formulaire soumis avec succÃ¨s');
    });

    // Initialize form
    document.addEventListener('DOMContentLoaded', function() {
      showStep(1);
    });
  </script>

</body>
</html>