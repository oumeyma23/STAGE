<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulaire de demande de crédit</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <style>
    :root{
      --c1:#C2E0E3;
      --c2:#E0FCFC;
      --c3:#9DB5C0;
      --accent:#4543435e;
    }

    body{
      background: linear-gradient(180deg,var(--c2) 0%, #ffffff 100%);
      font-family: Arial, sans-serif;
      color:#222;
      padding:20px;
    }

    .card{
      border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
      border: none;
    }

    .card-header{
      background: linear-gradient(90deg,var(--c1), var(--c3));
      color:#08303a;
      font-weight:700;
      border-top-left-radius:16px;
      border-top-right-radius:16px;
    }

    .section-title{
      display:flex;
      align-items:center;
      gap:.5rem;
      margin-bottom:.75rem;
    }

    .title-label {
        color: #4543435e; /* Text color */
        font-weight: bold; /* Font weight */
        font-size: 16px; /* Font size */
        font-family: Arial, sans-serif; /* Font family */
        text-transform: uppercase; /* Transform text to uppercase */
        letter-spacing: 1px; /* Space between letters */
    }

    .required{color:#c0392b}
    small.form-text{color:#666}

    .file-preview{font-size:.9rem;color:#0b5560}

    .btn-primary{
      background:linear-gradient(90deg,#2b7680,#144f56);
      border:none;
    }

    @media (max-width:575px){
      .card{padding:12px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card mx-auto" style="max-width:1000px">
      <div class="card-header py-3">
        <h3 class="mb-0">Formulaire de demande de crédit</h3>
        <small>Remplissez toutes les informations et joignez les pièces justificatives demandées.</small>
      </div>
      <div class="card-body">
        <!-- Messages de succès et d'erreur -->
        {% if success %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{ success }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endif %}
        
        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          {{ error }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endif %}

<form id="creditForm" method="POST" action="/demande_credit" enctype="multipart/form-data" novalidate>

          <!-- Informations personnelles -->
          <div class="mb-4">
            <div class="section-title">
              <span class="title-label">1. Informations personnelles</span>
            </div>

            <div class="form-row">
              <div class="form-group col-md-4">
                <label>Nom <span class="required">*</span></label>
                <input type="text" class="form-control" name="nom" required maxlength="100" placeholder="Nom de famille">
              </div>

              <div class="form-group col-md-4">
                <label>Prénom <span class="required">*</span></label>
                <input type="text" class="form-control" name="prenom" required maxlength="100" placeholder="Prénom">
              </div>

              <div class="form-group col-md-4">
                <label>Date de naissance <span class="required">*</span></label>
                <input type="date" class="form-control" name="date_naissance" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-4">
                <label>Lieu de naissance</label>
                <input type="text" class="form-control" name="lieu_naissance" maxlength="100" placeholder="Ville, Pays">
              </div>

              <div class="form-group col-md-4">
                <label>Numéro CIN / Passeport <span class="required">*</span></label>
                <input type="text" class="form-control" name="document_id" required maxlength="30" placeholder="Ex: 01234567">
              </div>

              <div class="form-group col-md-4">
                <label>Nationalité</label>
                <input type="text" class="form-control" name="nationalite" maxlength="50" placeholder="Tunisienne">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Adresse complète <span class="required">*</span></label>
                <input type="text" class="form-control" name="adresse" required placeholder="Rue, ville, code postal">
                <small class="form-text">Justificatif de domicile requis (facture STEG/SONEDE, etc.)</small>
              </div>

              <div class="form-group col-md-3">
                <label>Téléphone <span class="required">*</span></label>
                <input type="tel" class="form-control" name="telephone" required pattern="[0-9+()\-\s]{6,20}" placeholder="+216 XX XXX XXX">
              </div>

              <div class="form-group col-md-3">
                <label>Email</label>
                <input type="email" class="form-control" name="email" placeholder="exemple@domaine.tn">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-3">
                <label>Situation familiale</label>
                <select class="form-control" name="situation_familiale">
                  <option value="">--Sélectionner--</option>
                  <option>Célibataire</option>
                  <option>Marié(e)</option>
                  <option>Divorcé(e)</option>
                  <option>Veuf/Veuve</option>
                </select>
              </div>

              <div class="form-group col-md-3">
                <label>Nombre d'enfants</label>
                <input type="number" class="form-control" name="enfants" min="0" max="20" value="0">
              </div>
            </div>
          </div>

          <!-- Informations professionnelles -->
          <div class="mb-4">
            <div class="section-title">
              <span class="title-label">2. Informations professionnelles</span>
            </div>

            <div class="form-row">
              <div class="form-group col-md-4">
                <label>Profession / Poste</label>
                <input type="text" class="form-control" name="profession" maxlength="100">
              </div>

              <div class="form-group col-md-4">
                <label>Nom de l'employeur</label>
                <input type="text" class="form-control" name="employeur" maxlength="150">
              </div>

              <div class="form-group col-md-4">
                <label>Secteur d'activité</label>
                <input type="text" class="form-control" name="secteur" maxlength="100">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-3">
                <label>Type de contrat</label>
                <select class="form-control" name="type_contrat">
                  <option value="">--Sélectionner--</option>
                  <option>CDI</option>
                  <option>CDD</option>
                  <option>Indépendant / Freelance</option>
                  <option>Retraité</option>
                  <option>Autre</option>
                </select>
              </div>

              <div class="form-group col-md-3">
                <label>Ancienneté (années)</label>
                <input type="number" class="form-control" name="anciennete" min="0" max="60">
              </div>

              <div class="form-group col-md-3">
                <label>Revenu mensuel net (TND) <span class="required">*</span></label>
                <input type="number" step="0.01" class="form-control" name="revenu" required min="0">
              </div>

              <div class="form-group col-md-3">
                <label>Autres revenus</label>
                <input type="number" step="0.01" class="form-control" name="autres_revenus" min="0" placeholder="loyers, pension...">
              </div>
            </div>
          </div>

          <!-- Informations financières -->
          <div class="mb-4">
            <div class="section-title">
              <span class="title-label">3. Informations financières</span>
            </div>

            <div class="form-row">
              <div class="form-group col-md-4">
                <label>Revenu mensuel du ménage (TND)</label>
                <input type="number" step="0.01" class="form-control" name="revenu_menage" min="0">
              </div>

              <div class="form-group col-md-4">
                <label>Dépenses mensuelles fixes (TND)</label>
                <input type="number" step="0.01" class="form-control" name="depenses" min="0" placeholder="loyer, charges, autres crédits">
              </div>

              <div class="form-group col-md-4">
                <label>Crédits en cours (mensualités totales TND)</label>
                <input type="number" step="0.01" class="form-control" name="credits_en_cours" min="0">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Comptes bancaires (banque principale)</label>
                <input type="text" class="form-control" name="compte_banque" maxlength="150" placeholder="Nom de la banque, IBAN si applicable">
              </div>

              <div class="form-group col-md-6">
                <label>Épargne / Patrimoine (biens notables)</label>
                <input type="text" class="form-control" name="epargne" maxlength="250" placeholder="Immeuble, véhicule, etc.">
              </div>
            </div>
          </div>

          <!-- Détails du crédit demandé -->
          <div class="mb-4">
            <div class="section-title">
              <span class="title-label">4. Détails du crédit demandé</span>
            </div>

            <div class="form-row">
              <div class="form-group col-md-4">
                <label>Type de crédit <span class="required">*</span></label>
                <select class="form-control" name="type_credit" required>
                  <option value="">--Sélectionner--</option>
                  <option>Crédit consommation</option>
                  <option>Crédit immobilier</option>
                  <option>Crédit auto</option>
                  <option>Crédit personnel</option>
                  <option>Regroupement de crédits</option>
                </select>
              </div>

              <div class="form-group col-md-4">
                <label>Montant demandé (TND) <span class="required">*</span></label>
                <input type="number" class="form-control" name="montant" required min="0" step="0.01">
              </div>

              <div class="form-group col-md-4">
                <label>Durée souhaitée (mois) <span class="required">*</span></label>
                <input type="number" class="form-control" name="duree" required min="1" max="480">
              </div>
            </div>

            <div class="form-group">
              <label>Objet du crédit</label>
              <textarea class="form-control" name="objet" rows="2" maxlength="500" placeholder="Ex: Achat voiture, Travaux, Achat immobilier..."></textarea>
            </div>

            <div class="form-group">
              <label>Garanties proposées</label>
              <input type="text" class="form-control" name="garanties" maxlength="300" placeholder="Ex: hypothèque, caution, domiciliation salaire...">
            </div>
          </div>

          <!-- Pièces justificatives -->
          <div class="mb-4">
            <div class="section-title">
              <span class="title-label">5. Pièces justificatives (à joindre)</span>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Copie CIN / Passeport <span class="required">*</span></label>
                <input type="file" class="form-control-file" name="file_id" accept="image/*,.pdf" required>
                <div class="file-preview" id="preview_id"></div>
              </div>

              <div class="form-group col-md-6">
                <label>Justificatif de domicile <span class="required">*</span></label>
                <input type="file" class="form-control-file" name="file_domicile" accept="image/*,.pdf" required>
                <div class="file-preview" id="preview_domicile"></div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>Bulletins de salaire / Preuves de revenu (3 derniers mois) <span class="required">*</span></label>
                <input type="file" class="form-control-file" name="file_revenus" accept="application/pdf,image/*" required multiple>
                <div class="file-preview" id="preview_revenus"></div>
              </div>

              <div class="form-group col-md-6">
                <label>Relevés bancaires récents (3 derniers mois)</label>
                <input type="file" class="form-control-file" name="file_releves" accept="application/pdf,image/*" multiple>
                <div class="file-preview" id="preview_releves"></div>
              </div>
            </div>

            <small class="form-text">Format accepté : PDF, JPG, PNG. Taille maximum recommandée par fichier : 10MB.</small>
          </div>

          <!-- Consentement -->
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="consent" required>
            <label class="form-check-label" for="consent">J'autorise la banque à vérifier les informations fournies et à effectuer des vérifications de crédit. <span class="required">*</span></label>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">Réinitialiser</button>
            <button type="submit" class="btn btn-primary">Soumettre la demande</button>
          </div>

        </form>

        <div class="mt-3" id="result" style="display:none"></div>

      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    // Affiche le nom des fichiers sélectionnés
    function showPreview(input, containerId){
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if(!input.files || input.files.length===0) return;
      const list = document.createElement('ul');
      for(const f of input.files){
        const li = document.createElement('li');
        li.textContent = f.name + ' (' + Math.round(f.size/1024) + ' KB)';
        list.appendChild(li);
      }
      container.appendChild(list);
    }

    document.querySelector('input[name=file_id]').addEventListener('change', e=> showPreview(e.target, 'preview_id'));
    document.querySelector('input[name=file_domicile]').addEventListener('change', e=> showPreview(e.target, 'preview_domicile'));
    document.querySelector('input[name=file_revenus]').addEventListener('change', e=> showPreview(e.target, 'preview_revenus'));
    document.querySelector('input[name=file_releves]').addEventListener('change', e=> showPreview(e.target, 'preview_releves'));

    // Validation et soumission du formulaire
    document.getElementById('creditForm').addEventListener('submit', function(e){
      const form = e.target;
      if(!form.checkValidity()){
        e.preventDefault();
        form.classList.add('was-validated');
        window.scrollTo({top:0, behavior:'smooth'});
        return;
      }
      // Le formulaire est valide, on le laisse se soumettre normalement
    });

    function resetForm(){
      const f = document.getElementById('creditForm');
      f.reset();
      document.getElementById('result').style.display='none';
      ['preview_id','preview_domicile','preview_revenus','preview_releves'].forEach(id=>document.getElementById(id).innerHTML='');
      f.classList.remove('was-validated');
    }
  </script>
</body>
</html>
