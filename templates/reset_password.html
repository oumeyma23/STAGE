<!DOCTYPE html>
<html lang="{{ current_language or 'fr' }}" {% if current_language == 'ar' %}dir="rtl"{% endif %}>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  {% if current_language == 'ar' %}
    <title>إعادة تعيين كلمة المرور - SecuriBank</title>
  {% elif current_language == 'en' %}
    <title>Reset Password - SecuriBank</title>
  {% else %}
    <title>Réinitialiser le mot de passe - SecuriBank</title>
  {% endif %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <style>
    :root { --brand-blue:#0b2d4a; --primary:#f4623a; --text1:#2c3e50; --text2:#6b7280; }
    .auth-wrapper { min-height: 100vh; display:flex; }
    .left-pane { flex:1; display:flex; align-items:center; justify-content:center; padding:32px 48px; background:#fff; }
    .right-pane { flex:1; position:relative; background:#0b2d4a; color:#fff; display:none; overflow:hidden; }
    .hero { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
    .hero img { width:100%; height:100%; object-fit: cover; object-position:center; background:#0b2d4a; }
    @media (min-width: 992px) { .right-pane{ display:block; } }
    .card-form { width:100%; max-width:520px; }
    .title { font-size:28px; font-weight:800; color:var(--text1); margin-bottom:8px; }
    .subtitle { color:var(--text2); margin-bottom:20px; }
    .form-control { height:48px; }
    .btn-primary { background:var(--primary); border:none; height:48px; }
    .progress { height:6px; margin-top:6px; }
  </style>
</head>
<body>
  {% include 'navbar.html' %}
  <div class="auth-wrapper">
    <div class="left-pane">
      <div class="card-form text-start">
        <div class="title">
          {% if current_language=='ar' %}تعيين كلمة مرور جديدة{% elif current_language=='en' %}Set a new password{% else %}Définir un nouveau mot de passe{% endif %}
        </div>
        <div class="subtitle">
          {% if current_language=='ar' %}اختر كلمة مرور قوية لتأمين حسابك{% elif current_language=='en' %}Choose a strong password to secure your account{% else %}Choisissez un mot de passe fort pour sécuriser votre compte{% endif %}
        </div>

        {% if error %}<div class="alert alert-danger mb-3">{{ error }}</div>{% endif %}
        {% if success %}<div class="alert alert-success mb-3">{{ success }}</div>{% endif %}
        {% if token_invalid %}
          <a class="btn btn-primary" href="{{ url_for('forgot_password') }}">{% if current_language=='ar'%}رجوع{% elif current_language=='en'%}Back{% else %}Retour{% endif %}</a>
        {% elif done %}
          <a class="btn btn-primary" href="{{ url_for('login') }}">{% if current_language=='ar'%}تسجيل الدخول{% elif current_language=='en'%}Login{% else %}Se connecter{% endif %}</a>
        {% else %}
        <form method="POST" class="needs-validation" novalidate>
          <div class="mb-3">
            <label class="form-label" for="password">{% if current_language=='ar'%}كلمة المرور الجديدة{% elif current_language=='en'%}New password{% else %}Nouveau mot de passe{% endif %}</label>
            <input type="password" id="password" name="password" class="form-control" minlength="8" pattern="^(?=.*[A-Za-z])(?=.*\d).{8,}$" required>
            <div class="form-text">{% if current_language=='ar'%}8 أحرف على الأقل مع حرف ورقم{% elif current_language=='en'%}At least 8 characters with a letter and a number{% else %}Au moins 8 caractères avec une lettre et un chiffre{% endif %}</div>
            <div class="progress"><div id="pwdStrength" class="progress-bar" style="width:0%"></div></div>
          </div>
          <div class="mb-3">
            <label class="form-label" for="confirm">{% if current_language=='ar'%}تأكيد كلمة المرور{% elif current_language=='en'%}Confirm password{% else %}Confirmer le mot de passe{% endif %}</label>
            <input type="password" id="confirm" name="confirm" class="form-control" required>
            <div class="invalid-feedback">{% if current_language=='ar'%}يجب أن تتطابق كلمات المرور{% elif current_language=='en'%}Passwords must match{% else %}Les mots de passe doivent correspondre{% endif %}</div>
          </div>
          <button type="submit" class="btn btn-primary w-100">{% if current_language=='ar'%}تحديث كلمة المرور{% elif current_language=='en'%}Update password{% else %}Mettre à jour le mot de passe{% endif %}</button>
        </form>
        {% endif %}
      </div>
    </div>
    <div class="right-pane">
      <div class="hero">
        <img src="{{ url_for('static', filename='assets/img/Image3.png') }}" alt="reset" />
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      const form = document.querySelector('.needs-validation');
      const pwd = document.getElementById('password');
      const confirm = document.getElementById('confirm');
      const bar = document.getElementById('pwdStrength');
      function validateMatch(){
        if (!confirm) return;
        confirm.setCustomValidity(pwd && confirm && pwd.value !== confirm.value ? 'mismatch' : '');
      }
      function strength(val){
        let s=0; if(val.length>=8)s+=25; if(/[A-Z]/.test(val))s+=20; if(/[a-z]/.test(val))s+=20; if(/\d/.test(val))s+=20; if(/[^A-Za-z0-9]/.test(val))s+=15; return Math.min(s,100);
      }
      function updateBar(){ if(!bar||!pwd) return; const v=strength(pwd.value); bar.style.width=v+'%'; bar.className='progress-bar'; bar.classList.add(v<40?'bg-danger':(v<70?'bg-warning':'bg-success')); }
      if (pwd){ pwd.addEventListener('input', updateBar); pwd.addEventListener('input', validateMatch); }
      if (confirm){ confirm.addEventListener('input', validateMatch); }
      if (form){ form.addEventListener('submit', function(e){ validateMatch(); if(!form.checkValidity()){ e.preventDefault(); e.stopPropagation(); } form.classList.add('was-validated'); }); }
      updateBar();
    })();
  </script>
</body>
</html>
